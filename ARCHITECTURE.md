# 🎨 项目可视化概览

## 系统架构图

```
┌─────────────────────────────────────────────────────────────────────┐
│                          用户浏览器                                 │
│                                                                     │
│  ┌───────────────────────────────────────────────────────────┐     │
│  │                    Vue.js 前端应用                        │     │
│  │  ┌─────────────┐  ┌──────────────┐  ┌─────────────────┐  │     │
│  │  │ FileUploader│  │ TaskStatus   │  │ FlashcardList   │  │     │
│  │  │   组件      │  │    组件      │  │     组件        │  │     │
│  │  └─────────────┘  └──────────────┘  └─────────────────┘  │     │
│  └───────────────────────────────────────────────────────────┘     │
│                              │                                      │
└──────────────────────────────┼──────────────────────────────────────┘
                               │ HTTP/HTTPS
                               │
┌──────────────────────────────▼──────────────────────────────────────┐
│                        Nginx 反向代理                                │
│  • 静态文件服务 (前端构建产物)                                       │
│  • API 请求转发                                                      │
│  • SSL/TLS 终止                                                      │
└──────────────────────────────┬──────────────────────────────────────┘
                               │
                ┌──────────────┴──────────────┐
                │                             │
        ┌───────▼────────┐           ┌───────▼────────┐
        │  Flask API     │           │  Static Files  │
        │  (Gunicorn)    │           │  (Vue dist/)   │
        └───────┬────────┘           └────────────────┘
                │
        ┌───────┴────────┐
        │                │
┌───────▼────────┐ ┌─────▼──────────┐
│ Text Extractor │ │  LLM Service   │
│  • PDF         │ │  • OpenAI API  │
│  • DOCX        │ │  • GPT-3.5     │
│  • PPTX        │ │  • Flashcard   │
│  • TXT         │ │    Generation  │
│  • OCR         │ │                │
└────────────────┘ └────────────────┘
        │
        ▼
┌────────────────────────────────────────┐
│         Celery Task Queue              │
│                                        │
│  ┌──────────────────────────────────┐ │
│  │      Celery Worker Pool          │ │
│  │  ┌────────┐ ┌────────┐ ┌──────┐ │ │
│  │  │Worker 1│ │Worker 2│ │Worker│ │ │
│  │  └────────┘ └────────┘ └──────┘ │ │
│  └──────────────────────────────────┘ │
└────────────────┬───────────────────────┘
                 │
        ┌────────▼────────┐
        │     Redis       │
        │  • Message      │
        │    Broker       │
        │  • Result       │
        │    Backend      │
        └─────────────────┘
```

## 数据流程图

```
1️⃣ 用户上传文件
    │
    ▼
┌─────────────────────────────┐
│ POST /api/generate-         │
│ flashcards-async            │
└──────────┬──────────────────┘
           │
           ▼
2️⃣ Flask 保存文件并创建任务
    │
    ├──► 保存到 uploads/
    └──► 创建 Celery Task
           │
           ▼
3️⃣ 返回 task_id (202 Accepted)
    │
    ▼
┌─────────────────────────────┐
│ {                           │
│   "task_id": "uuid",        │
│   "status_url": "/api/..."  │
│ }                           │
└─────────────────────────────┘
    │
    ▼
4️⃣ 前端开始轮询状态
    │ (每 2 秒)
    ▼
┌─────────────────────────────┐
│ GET /api/task-status/{id}   │
└──────────┬──────────────────┘
           │
           │ ◄────────────────┐
           │                  │
           ▼                  │
5️⃣ Celery Worker 处理任务    │
    │                         │
    ├──► 提取文本             │
    ├──► OCR (如需要)         │
    ├──► 调用 OpenAI API      │
    ├──► 生成闪卡             │
    └──► 存储结果到 Redis ────┘
           │
           ▼
6️⃣ 前端获取最终结果
    │
    ▼
┌─────────────────────────────┐
│ {                           │
│   "state": "SUCCESS",       │
│   "result": [               │
│     {                       │
│       "question": "...",    │
│       "answer": "..."       │
│     }                       │
│   ]                         │
│ }                           │
└─────────────────────────────┘
    │
    ▼
7️⃣ 展示闪卡并支持翻转
```

## 目录结构树

```
flashcard/
│
├── 📄 README.md                          # 项目主文档
├── 📄 TECHNICAL_DOCUMENTATION.md         # 技术设计文档
├── 📄 DEPLOYMENT.md                      # 部署指南
├── 📄 CONTRIBUTING.md                    # 贡献指南
├── 📄 PROJECT_SUMMARY.md                 # 项目总结
├── 📄 CHANGELOG.md                       # 变更日志
├── 📄 LICENSE                            # MIT 许可证
├── 🔧 docker-compose.yml                 # Docker Compose 配置
├── 🚀 setup.sh                           # 初始化脚本
├── 🚀 start-dev.sh                       # 开发启动脚本
│
├── 📁 backend/                           # 后端代码
│   ├── 📄 app.py                        # Flask 应用主文件
│   ├── 📄 requirements.txt              # Python 依赖
│   ├── 📄 Dockerfile                    # Docker 镜像配置
│   ├── 📄 .env.example                  # 环境变量模板
│   ├── 📄 .gitignore                    # Git 忽略配置
│   │
│   ├── 📁 services/                     # 业务逻辑服务
│   │   ├── 📄 __init__.py              # 包初始化
│   │   ├── 📄 text_extractor.py        # 文本提取服务
│   │   └── 📄 llm_service.py           # LLM 闪卡生成
│   │
│   └── 📁 uploads/                      # 文件上传目录
│       └── .gitkeep
│
├── 📁 frontend/                         # 前端代码
│   ├── 📄 index.html                   # HTML 入口
│   ├── 📄 package.json                 # Node 依赖
│   ├── 📄 vite.config.js               # Vite 配置
│   ├── 📄 .gitignore                   # Git 忽略配置
│   │
│   ├── 📁 public/                      # 静态资源
│   │
│   └── 📁 src/                         # 源代码
│       ├── 📄 main.js                  # 应用入口
│       ├── 📄 App.vue                  # 主组件
│       │
│       └── 📁 components/              # Vue 组件
│           ├── 📄 FileUploader.vue     # 文件上传
│           ├── 📄 TaskStatus.vue       # 任务状态
│           └── 📄 FlashcardList.vue    # 闪卡列表
│
└── 📁 nginx/                            # Nginx 配置
    └── 📄 nginx.conf                   # 反向代理配置
```

## 技术栈图谱

```
┌──────────────────────────────────────────────────────────┐
│                       前端层                             │
├──────────────────────────────────────────────────────────┤
│  Vue.js 3         │  Vite         │  Axios              │
│  Composition API  │  Dev Server   │  HTTP Client        │
└──────────────────────────────────────────────────────────┘
                           │
                           ▼
┌──────────────────────────────────────────────────────────┐
│                      网络层                              │
├──────────────────────────────────────────────────────────┤
│  Nginx                                                   │
│  • 反向代理  • 静态文件服务  • SSL 终止                 │
└──────────────────────────────────────────────────────────┘
                           │
                           ▼
┌──────────────────────────────────────────────────────────┐
│                    应用层 (API)                          │
├──────────────────────────────────────────────────────────┤
│  Flask            │  Flask-CORS   │  Gunicorn           │
│  Web Framework    │  跨域支持     │  WSGI Server        │
└──────────────────────────────────────────────────────────┘
                           │
                           ▼
┌──────────────────────────────────────────────────────────┐
│                    业务逻辑层                            │
├──────────────────────────────────────────────────────────┤
│  Text Extractor Service    │  LLM Service               │
│  • pypdfium2 (PDF)         │  • OpenAI API              │
│  • python-docx (Word)      │  • GPT-3.5-turbo           │
│  • python-pptx (PPT)       │  • JSON 解析               │
│  • pytesseract (OCR)       │                            │
│  • Google Vision (OCR)     │                            │
└──────────────────────────────────────────────────────────┘
                           │
                           ▼
┌──────────────────────────────────────────────────────────┐
│                    任务队列层                            │
├──────────────────────────────────────────────────────────┤
│  Celery                                                  │
│  • 异步任务处理  • 分布式队列  • 任务调度               │
└──────────────────────────────────────────────────────────┘
                           │
                           ▼
┌──────────────────────────────────────────────────────────┐
│                    数据存储层                            │
├──────────────────────────────────────────────────────────┤
│  Redis                                                   │
│  • 消息代理 (Broker)  • 结果存储 (Backend)              │
└──────────────────────────────────────────────────────────┘
                           │
                           ▼
┌──────────────────────────────────────────────────────────┐
│                    容器化层                              │
├──────────────────────────────────────────────────────────┤
│  Docker           │  Docker Compose                      │
│  容器运行时       │  服务编排                            │
└──────────────────────────────────────────────────────────┘
```

## 部署架构图

```
┌──────────────────────────────────────────────────────────┐
│                    云服务器 / VPS                        │
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │              Docker Compose Network                │ │
│  │                                                    │ │
│  │  ┌──────────┐  ┌──────────┐  ┌──────────┐        │ │
│  │  │  Nginx   │  │  Redis   │  │  Backend │        │ │
│  │  │ Container│  │ Container│  │ Container│        │ │
│  │  │  (80)    │  │  (6379)  │  │  (5000)  │        │ │
│  │  └────┬─────┘  └────┬─────┘  └────┬─────┘        │ │
│  │       │             │             │               │ │
│  │       │     ┌───────┴─────┐       │               │ │
│  │       │     │             │       │               │ │
│  │  ┌────▼─────▼──┐     ┌────▼───────▼──┐           │ │
│  │  │  Volume:    │     │  Worker        │           │ │
│  │  │  redis_data │     │  Container     │           │ │
│  │  └─────────────┘     └────────────────┘           │ │
│  │                                                    │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  外部访问: http://server-ip 或 https://domain.com        │
└──────────────────────────────────────────────────────────┘

服务依赖:
  Nginx → Backend
  Backend → Redis
  Worker → Redis, Backend
```

## 文件处理流程图

```
支持的格式: .pdf, .docx, .pptx, .txt

┌─────────┐
│  .pdf   │
└────┬────┘
     │
     ├──► PDF 是否包含文本?
     │         │
     │      是 ├──► pypdfium2 提取
     │         │
     │      否 ├──► 渲染为图像
     │              │
     │              └──► OCR 识别
     │                      │
     │                   使用?
     │              ┌───────┴────────┐
     │              │                │
     │          Tesseract      Google Vision
     │           (默认)          (可选)
     │
     ▼
┌──────────────┐
│ 提取的文本   │
└──────┬───────┘
       │
       ├──► .docx ──► python-docx ──┐
       │                            │
       ├──► .pptx ──► python-pptx ──┤
       │                            │
       ├──► .txt  ──► 直接读取 ─────┤
       │                            │
       └────────────────────────────┘
                     │
                     ▼
            ┌────────────────┐
            │   合并文本     │
            └────────┬───────┘
                     │
                     ▼
            ┌────────────────┐
            │  OpenAI GPT    │
            │  生成闪卡      │
            └────────┬───────┘
                     │
                     ▼
            ┌────────────────┐
            │  JSON 闪卡     │
            │  [             │
            │    {           │
            │      question, │
            │      answer    │
            │    }           │
            │  ]             │
            └────────────────┘
```

## 组件交互图

```
FileUploader.vue                TaskStatus.vue           FlashcardList.vue
┌──────────────┐               ┌──────────────┐         ┌──────────────┐
│              │               │              │         │              │
│  点击/拖拽   │               │  轮询状态    │         │  显示闪卡    │
│  上传文件    │               │  (每2秒)     │         │  翻转动画    │
│              │               │              │         │              │
└──────┬───────┘               └──────┬───────┘         └──────▲───────┘
       │                              │                        │
       │ @upload-success              │ @task-complete         │
       │ (emit task_id)               │ (emit flashcards)      │
       │                              │                        │
       └──────────────┬───────────────┴────────────────────────┘
                      │
                      ▼
            ┌─────────────────┐
            │    App.vue      │
            │  (Parent)       │
            │                 │
            │  • taskId       │
            │  • flashcards   │
            └─────────────────┘
```

## 配置流程图

```
开发环境启动:
1. setup.sh
   ├── 检查 Python, Node.js, Docker
   ├── 创建 Python venv
   ├── 安装 Python 依赖
   ├── 创建 .env 文件
   ├── 安装 Node 依赖
   └── 启动 Redis 容器

2. start-dev.sh
   └── 启动 Redis (如未运行)

3. 手动启动:
   ├── Terminal 1: Celery Worker
   ├── Terminal 2: Flask API
   └── Terminal 3: Vite Dev Server

生产环境部署:
1. 配置 backend/.env
2. 构建前端: npm run build
3. docker-compose up -d --build
   ├── 启动 Redis
   ├── 启动 Backend (Gunicorn)
   ├── 启动 Worker (Celery)
   └── 启动 Nginx
```

---

**可视化总结**:
- 🏗️ 4 层架构 (前端、网络、应用、数据)
- 🔄 7 步数据流程 (上传 → 处理 → 展示)
- 📦 4 个 Docker 容器 (Nginx, Backend, Worker, Redis)
- 🎨 7 个 Vue 组件
- 📚 8 个文档文件
- 🛠️ 2 个自动化脚本
